# Структура проекта Clindoc App

## Общее описание

**Clindoc App** — это веб-приложение для помощи в подготовке и редактировании регуляторной и медицинской документации (CSR - Clinical Study Report). Приложение построено на React + TypeScript с использованием Vite в качестве сборщика и Material-UI для пользовательского интерфейса.

---

## Структура каталогов и файлов

### Корневой каталог проекта

#### Конфигурационные файлы

- **`package.json`** — файл управления зависимостями Node.js. Определяет скрипты сборки (`dev`, `build`, `lint`, `preview`), зависимости проекта (React, Material-UI, TypeScript) и dev-зависимости (ESLint, Vite, TypeScript).

- **`package-lock.json`** — автоматически генерируемый файл, фиксирующий точные версии всех зависимостей и их подзависимостей для обеспечения воспроизводимости сборок.

- **`vite.config.ts`** — конфигурация сборщика Vite. Настраивает плагин `@vitejs/plugin-react` для обработки JSX/TSX файлов.

- **`tsconfig.json`** — корневой файл конфигурации TypeScript. Использует проектные ссылки на `tsconfig.app.json` и `tsconfig.node.json` для раздельной настройки приложения и инструментов сборки.

- **`tsconfig.app.json`** — конфигурация TypeScript для исходного кода приложения. Настраивает строгий режим, ES2022, модульную систему ESNext, JSX режим React.

- **`tsconfig.node.json`** — конфигурация TypeScript для Node.js скриптов (например, `vite.config.ts`).

- **`eslint.config.js`** — конфигурация линтера ESLint. Настраивает правила для TypeScript, React Hooks, React Refresh и общие рекомендации JavaScript.

- **`index.html`** — точка входа HTML-документа. Содержит корневой элемент `<div id="root">` для монтирования React-приложения.

- **`README.md`** — документация проекта с описанием настройки и использования шаблона React + Vite.

#### Документация

- **`PRODUCT_DESC.MD`** — описание продукта: целевая аудитория, типы документов, базовые модули, сценарии использования, MVP-версия.

- **`MVP_DESC.MD`** — детальное описание MVP: архитектура, границы функциональности, технические требования, минимальный функционал для пилота.

#### Каталоги

- **`node_modules/`** — каталог с установленными npm-зависимостями (игнорируется в git).

- **`public/`** — статические файлы, которые копируются в корень сборки без обработки.
  - **`vite.svg`** — логотип Vite (пример статического ресурса).

- **`src/`** — основной каталог исходного кода приложения (см. детальное описание ниже).

---

### Каталог `src/` — исходный код приложения

#### Точки входа

- **`main.tsx`** — точка входа приложения. Инициализирует React-приложение через `ReactDOM.createRoot`, настраивает Material-UI `ThemeProvider` и `CssBaseline`, оборачивает приложение в `AuthProvider` для управления аутентификацией и монтирует корневой компонент `App`.

- **`App.tsx`** — корневой компонент приложения. Управляет состоянием выбранного исследования, проверяет аутентификацию через `useAuth` и отображает `LoginPage` или `MainLayout` с `StudyCsrPage` в зависимости от статуса авторизации. Передает `selectedStudyId` и обработчик `onSelectStudy` в `MainLayout`.

- **`App.css`** — глобальные стили для компонента App (если используются).

- **`index.css`** — глобальные CSS-стили приложения (сброс стилей, базовые настройки).

#### Каталог `src/api/` — слой API-клиента

Содержит модули для взаимодействия с backend API. Все модули используют общий `httpClient` для выполнения HTTP-запросов с автоматической обработкой авторизации.

- **`httpClient.ts`** — базовый HTTP-клиент. Реализует функции `getJson` и `postJson` для GET и POST запросов, автоматически добавляет JWT-токен из `tokenStorage`, обрабатывает ошибки (включая 401 для разлогинивания), формирует URL через `apiUrl` из `config.ts`.

- **`authApi.ts`** — API для аутентификации: логин, регистрация, обновление токена, выход.

- **`studiesApi.ts`** — API для работы с исследованиями (studies): получение списка, создание, обновление, удаление исследований.

- **`csrApi.ts`** — API для работы с CSR-документами: получение структуры документа (`getCsrDocument`), получение последней версии раздела (`getLatestSectionVersion`), сохранение версии раздела (`saveSectionVersion`), экспорт документа.

- **`sourcesApi.ts`** — API для работы с исходными документами (протоколы, SAP, TLF, прошлые CSR): загрузка файлов, получение списка источников, индексация для RAG.

- **`templatesApi.ts`** — API для работы с шаблонами документов: получение списка шаблонов, структуры шаблона, стандартных блоков текста.

- **`aiApi.ts`** — API для взаимодействия с AI-сервисом: генерация текста разделов (`generateSectionText`), рефрейзинг, Q&A по документам, получение контекста для промптов.

#### Каталог `src/auth/` — аутентификация и авторизация

- **`AuthContext.tsx`** — React Context для управления состоянием аутентификации. Предоставляет провайдер `AuthProvider` и хук `useAuth` для доступа к состоянию авторизации, функциям логина/логаута, информации о пользователе.

- **`tokenStorage.ts`** — утилиты для работы с JWT-токенами в localStorage: сохранение, получение, очистка токена доступа.

#### Каталог `src/types/` — TypeScript типы и интерфейсы

Централизованное хранение типов данных для обеспечения типобезопасности и переиспользования.

- **`auth.ts`** — типы для аутентификации: `User`, `LoginRequest`, `LoginResponse`, `AuthState`.

- **`study.ts`** — типы для исследований: `Study`, `StudyPhase`, `StudyStatus`, `CreateStudyRequest`.

- **`csr.ts`** — типы для CSR-документов: `CsrDocument`, `CsrSection`, `CsrSectionVersion`, `SectionSource` (human/ai), `CreateSectionVersionRequest`.

- **`source.ts`** — типы для исходных документов: `SourceDocument`, `SourceType` (protocol/sap/tlf/csr_prev), `UploadSourceRequest`.

- **`template.ts`** — типы для шаблонов: `Template`, `TemplateSection`, `TemplateBlock`.

#### Каталог `src/components/` — React компоненты

Организованы по функциональным группам для удобной навигации и поддержки.

##### `src/components/navigation/` — компоненты навигации

- **`AppHeader.tsx`** — верхняя панель приложения (AppBar): отображает заголовок "CSR Assistant MVP", фиксированная позиция с учетом ширины боковой панели.

- **`LeftSidebar.tsx`** — левый боковой панель (Drawer): загружает список исследований через `listStudies` API, отображает их в виде списка с кодом и названием, позволяет выбирать активное исследование, показывает состояние загрузки и ошибки.

- **`SectionTree.tsx`** — компонент дерева разделов CSR: отображает список разделов документа в виде списка, позволяет выбирать разделы для редактирования, подсвечивает выбранный раздел.

##### `src/components/editor/` — компоненты редактора

- **`CsrEditor.tsx`** — основной редактор текста разделов CSR: многострочное текстовое поле для редактирования разделов, загрузка последней версии раздела, сохранение изменений, интеграция с AI для генерации текста, вставка текста из шаблонов. Поддерживает режимы замены и добавления текста при генерации через AI.

- **`EditorToolbar.tsx`** — панель инструментов редактора: кнопки сохранения, генерации через AI, вставки из шаблона, переключатель режима вставки AI (replace/append).

##### `src/components/ai/` — AI-ассистент

- **`AiAssistantPanel.tsx`** — панель AI-ассистента: интерфейс для взаимодействия с AI, текстовое поле для ввода промптов, отображение последнего запроса и ответа, отправка запросов на генерацию текста через `generateSectionText` API.

##### `src/components/issues/` — проверка консистентности

- **`IssueListPanel.tsx`** — панель списка замечаний консистентности: отображение найденных проблем (endpoints, популяции, ссылки на таблицы), фильтрация по серьезности, навигация к проблемным местам в тексте.

##### `src/components/studies/` — работа с исследованиями

- **`StudyDocumentsPanel.tsx`** — панель документов исследования: список загруженных исходных документов (протокол, SAP, TLF), статусы индексации, возможность загрузки новых файлов.

##### `src/components/templates/` — шаблоны

- **`TemplatePickerDialog.tsx`** — диалог выбора шаблона: отображение доступных шаблонов CSR, предпросмотр структуры, выбор шаблона для вставки текста в раздел. Поддерживает рендеринг шаблона с подстановкой данных исследования и применение результата в редактор.

##### `src/components/common/` — общие компоненты

- **`SplitPane.tsx`** — компонент разделяемой панели: позволяет пользователю изменять размеры панелей (например, дерево разделов, редактор, панель ассистента).

#### Каталог `src/pages/` — страницы приложения

- **`LoginPage.tsx`** — страница входа: форма логина (email/username, пароль), обработка ошибок авторизации, редирект после успешного входа.

- **`StudyCsrPage.tsx`** — основная страница работы с CSR: объединяет компоненты редактора (`CsrEditor`), дерева разделов (`SectionTree`), AI-ассистента (`AiAssistantPanel`), панели документов исследования (`StudyDocumentsPanel`) и панели замечаний (`IssueListPanel`) в единый интерфейс редактирования документа. Загружает структуру CSR-документа при выборе исследования, управляет состоянием выбранного раздела.

#### Каталог `src/layouts/` — макеты страниц

- **`MainLayout.tsx`** — основной макет приложения: структура с фиксированным `AppHeader`, постоянным `LeftSidebar` (ширина 260px), центральной областью контента для дочерних компонентов, управление выбором исследования через пропсы `selectedStudyId` и `onSelectStudy`.

#### Каталог `src/theme/` — темизация

- **`index.ts`** — конфигурация темы Material-UI: определение цветовой палитры, типографики, компонентов, кастомизация под брендинг приложения.

#### Каталог `src/assets/` — статические ресурсы

- **`react.svg`** — логотип React (пример ресурса).

#### Конфигурация

- **`config.ts`** — конфигурация приложения: базовый URL API (`API_BASE_URL`, по умолчанию `http://127.0.0.1:8000`), функция `apiUrl` для формирования полных URL с автоматическим добавлением префикса `/api/v1` к путям, которые его не содержат.

---

## Подход к разработке

### Архитектурный подход

Проект следует **модульной архитектуре** с четким разделением ответственности (Separation of Concerns):

1. **Слоистая архитектура (Layered Architecture)**
   - **Presentation Layer** (`components/`, `pages/`, `layouts/`) — UI компоненты и страницы
   - **Business Logic Layer** (`api/`, `auth/`) — бизнес-логика и взаимодействие с backend
   - **Data Layer** (`types/`) — модели данных и типы
   - **Infrastructure Layer** (`config.ts`, `httpClient.ts`) — конфигурация и инфраструктурные утилиты

2. **Component-Based Architecture**
   - Приложение построено на React-компонентах с переиспользованием
   - Компоненты организованы по функциональным доменам (navigation, editor, assistant, issues)
   - Использование React Context для глобального состояния (AuthContext)

3. **API-First Approach**
   - Четкое разделение между frontend и backend через REST API
   - Централизованный HTTP-клиент с единой обработкой ошибок и авторизации
   - Типизированные API-модули для каждого домена (studies, csr, sources, templates, ai)

### Технологический стек

- **Frontend Framework**: React 19.2.0 с React DOM 19.2.0 и TypeScript
- **Build Tool**: Vite 7.2.4 с плагином @vitejs/plugin-react 5.1.1 (быстрая разработка с HMR)
- **UI Library**: Material-UI (MUI) 7.3.6 с @mui/icons-material 7.3.6
- **Styling**: Emotion (@emotion/react 11.14.0, @emotion/styled 11.14.1, встроен в MUI) + CSS
- **Type Safety**: TypeScript 5.9.3 со строгим режимом
- **Code Quality**: ESLint 9.39.1 с плагинами для React Hooks, React Refresh и TypeScript ESLint 8.46.4

### Принципы разработки

1. **Type Safety First**
   - Строгая типизация TypeScript
   - Централизованное хранение типов в `types/`
   - Типизированные API-запросы и ответы

2. **Separation of Concerns**
   - Разделение UI, бизнес-логики и данных
   - API-модули изолированы от компонентов
   - Утилиты вынесены в отдельные модули

3. **Reusability**
   - Переиспользуемые компоненты в `components/common/`
   - Общий HTTP-клиент для всех API-запросов
   - Централизованная конфигурация

4. **Maintainability**
   - Модульная структура каталогов
   - Понятные имена файлов и компонентов
   - Документированные типы и интерфейсы

5. **Security**
   - JWT-авторизация с автоматической обработкой токенов
   - Безопасное хранение токенов в localStorage
   - Автоматический logout при 401 ошибке

### Паттерны проектирования

1. **Context API Pattern** — для глобального состояния аутентификации
2. **Repository Pattern** — API-модули как репозитории для работы с данными
3. **Container/Presentational Pattern** — разделение логики (pages) и представления (components)
4. **Custom Hooks Pattern** — `useAuth` для инкапсуляции логики аутентификации

### Процесс разработки

1. **Development**
   - `npm run dev` — запуск dev-сервера с Hot Module Replacement
   - Автоматическая перезагрузка при изменении кода
   - Проксирование API-запросов через Vite (настраивается в `vite.config.ts`)

2. **Build**
   - `npm run build` — сборка production-версии с оптимизацией
   - TypeScript компиляция с проверкой типов
   - Минификация и tree-shaking через Vite

3. **Code Quality**
   - `npm run lint` — проверка кода через ESLint
   - Строгие правила TypeScript для предотвращения ошибок
   - Автоматическая проверка при коммитах (при настройке pre-commit hooks)

### Интеграция с Backend

- **API Base URL**: настраивается в `config.ts` (по умолчанию `http://127.0.0.1:8000`)
- **API Versioning**: автоматическое добавление префикса `/api/v1` к путям
- **Authentication**: JWT Bearer токены в заголовке `Authorization`
- **Error Handling**: централизованная обработка ошибок в `httpClient.ts`

### Масштабируемость

Архитектура спроектирована для легкого расширения:

- Добавление новых API-модулей в `api/`
- Создание новых компонентов в соответствующих подкаталогах `components/`
- Расширение типов в `types/`
- Добавление новых страниц в `pages/` и маршрутов в `App.tsx`

### Соответствие MVP требованиям

Структура проекта соответствует описанным в `MVP_DESC.MD` требованиям:

- ✅ Модульная архитектура с разделением на слои
- ✅ Компонентная структура для UI
- ✅ API-слой для взаимодействия с backend
- ✅ Типизация для безопасности типов
- ✅ Аутентификация и авторизация
- ✅ Подготовка к интеграции с AI-сервисами
- ✅ Структура для работы с документами и исследованиями

---

## Заключение

Структура проекта организована для поддержки MVP функциональности ассистента для подготовки CSR-документов с возможностью генерации текста через AI, проверки консистентности и управления версиями документов. Модульная архитектура обеспечивает легкость расширения и поддержки кода.

