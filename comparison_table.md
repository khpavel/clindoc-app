# Сравнение реализации MVP с Prod-спеками

Данный документ содержит детальное сравнение текущей реализации MVP с требованиями Prod и Prod+ из спецификации `full_product_USR.md`.

## Краткая сводная таблица по блокам

| № | Блок | Статус в MVP | Приоритет для Prod |
|---|------|--------------|-------------------|
| 1 | Пользователи и проекты | Частично (базовая аутентификация) | Высокий |
| 2 | Документы-источники | Базовая загрузка | Средний |
| 3 | Структура документа и редактор | Базовый редактор текста | Высокий |
| 4 | AI-ассистент | Базовая генерация текста | Средний |
| 5 | RAG | Просмотр чанков | Средний |
| 6 | Consistency / QC | Только mock-данные | Критический |
| 7 | Экспорт и формат | Отсутствует | Критический |
| 8 | Техническая гигиена | Базовая структура | Высокий |
| 9 | Дополнительные компоненты | Отсутствуют | Низкий |

## Структура сравнения

Для каждого блока верхнего уровня выделены:
- **Что есть в MVP** — реализованная функциональность
- **Что отсутствует в Prod** — необходимые функции для базового продакшена
- **Что отсутствует в Prod+** — расширенная enterprise-функциональность

---

## 1. Пользователи и проекты

### 1.1. Модель пользователей (Prod)

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовый логин (email/username + пароль)<br>• JWT-аутентификация<br>• Хранение токена в localStorage<br>• Базовая проверка аутентификации |
| **Что отсутствует в Prod** | • Профиль пользователя (имя, фамилия, должность, организация, часовой пояс)<br>• Флаги: активен/деактивирован, требуется смена пароля<br>• Минимальные требования к паролю<br>• Пригласительная модель регистрации (админ создает, отправка письма/ссылки)<br>• Массовая загрузка пользователей (CSV/Excel)<br>• Блокировка/разблокировка без удаления истории<br>• Страница "Мой профиль" с редактированием данных и сменой пароля<br>• Отображение роли/ролей и списка проектов с доступом |
| **Что отсутствует в Prod+** | • Организации/тенанты (multi-tenant архитектура)<br>• Связь пользователей и проектов с организацией<br>• Изоляция данных между организациями<br>• Сущность "Спонсор" как справочник<br>• Расширенный RBAC (Org Admin, Sponsor Admin, Portfolio Manager)<br>• Проектные роли с детальными правами<br>• Настройка ролей в админке с матрицей прав<br>• SSO (SAML/OAuth2/OIDC)<br>• SCIM для синхронизации с IdP<br>• Маппинг групп/атрибутов IdP на роли |

### 1.2. Модель проектов / исследований (Prod)

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовые поля проекта (id, code, title, phase)<br>• Список исследований в боковой панели<br>• Выбор активного исследования<br>• API для получения списка и создания |
| **Что отсутствует в Prod** | • Уникальный project_id/study_id<br>• Расширенные поля: спонсор, показание, тип исследования<br>• Статус проекта (draft/active/in_QC/submitted/archived)<br>• Владелец проекта (ответственный пользователь)<br>• Создание проекта с правом "create_project"<br>• Перевод по статусам с контролем прав<br>• Логирование изменений статуса<br>• Архивный статус с read-only доступом<br>• Структура внутри проекта (список документов/артефактов)<br>• Привязка источников RAG к проекту<br>• Ключевые даты (начало/окончание набора, ЛПД, целевая дата подачи) |
| **Что отсутствует в Prod+** | • Иерархия проектов и портфели<br>• Сущность "Портфель"/"Программа" (группировка по препарату, показанию, региону)<br>• Права на уровень портфеля<br>• Иерархия: Портфель → Проект → Документы<br>• Разделение PROD/UAT/DEV окружений<br>• Миграция проектов/шаблонов из UAT в PROD<br>• Настройки квот (лимиты на проекты, пользователей, хранилище на организацию) |

### 1.3. Связь "пользователи ↔ проекты" (Prod)

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Пользователь видит список исследований<br>• Базовое ограничение доступа через API |
| **Что отсутствует в Prod** | • Явная модель membership (project_member таблица: user_id + project_id + роль)<br>• Роли внутри проекта (Project Owner, Editor, Viewer)<br>• Project Owner может добавлять/удалять участников, менять роли, назначать владельца<br>• Проверки: нельзя удалить последнего владельца<br>• Страница "Мои проекты" с фильтрацией по статусу<br>• Быстрый поиск по коду/названию<br>• Отображение роли пользователя в каждом проекте<br>• Сортировки (по дате обновления, статусу, спонсору) |
| **Что отсутствует в Prod+** | • Удаление участника с проверкой незавершенных задач<br>• Portfolio Manager видит все исследования по молекуле<br>• Расширенные права на уровне портфеля |

### 1.4. Роли и права доступа (Prod)

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовая проверка аутентификации<br>• JWT-токены для доступа к API |
| **Что отсутствует в Prod** | • Глобальные роли системы (Admin, User)<br>• Admin: управление пользователями, просмотр всех проектов, настройка конфигураций<br>• User: доступ только к проектам-участникам<br>• Централизованная проверка прав на уровне API<br>• Проверка membership и роли при действиях с проектом/документом<br>• Доступ к RAG-данным строго в рамках проектов пользователя<br>• Логирование отказов в доступе |
| **Что отсутствует в Prod+** | • Расширенные роли (Org Admin, Sponsor Admin, Portfolio Manager)<br>• Проектные роли с детальными правами (редактирование только efficacy, но не safety)<br>• Настройка ролей в административном интерфейсе<br>• Матрица прав для ролей |

### 1.5. Аудит и история действий (Prod)

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовая структура для работы с документами |
| **Что отсутствует в Prod** | • Логирование ключевых событий: создание/изменение/архивация проекта, добавление/удаление участника, изменение ролей, изменение статуса<br>• Хранение: кто, когда, что изменил<br>• Привязка к версиям документов (кто создал/обновил версию)<br>• Связка версий с пользователями и статусами проекта |
| **Что отсутствует в Prod+** | • Тонкий аудит: входы/выходы, попытки доступа без прав, массовые изменения прав<br>• Политики безопасности (требования к паролю, срок жизни, автоматическая блокировка)<br>• Отчеты для QA/RA с возможностью выгрузить список всех мест использования AI |

---

## 2. Документы-источники

### 2.1. Общая концепция документов-источников

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовые типы документов (protocol, sap, tlf, csr_prev)<br>• Загрузка файлов через UI<br>• Список загруженных документов<br>• API для загрузки и получения списка |
| **Что отсутствует в Prod** | • Модель данных SourceDocument с расширенными полями (version_label, language, region, status, source_system, storage_path, file_name, mime_type, size_bytes)<br>• Типы документов: ib, smpc, other<br>• Возможность отметить "ключевые" документы для RAG/QC<br>• Проверка расширения и валидности при загрузке<br>• Безопасное хранение (S3-совместимое хранилище)<br>• Скачивание файлов пользователями с правами |
| **Что отсутствует в Prod+** | • Расширенные типы и подтипы (Protocol original/amendment, SAP original/update, CSR draft/final/addendum, Regulatory correspondence)<br>• Маппинг типов на регуляторные артефакты (CTD-модуль, раздел ICH E3) |

### 2.2. PROD — базовый уровень для документов-источников

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Загрузка документов-источников<br>• Базовый список документов с типом и датой загрузки<br>• Ручная индексация для RAG (indexSourceDocument API) |
| **Что отсутствует в Prod** | • Базовое версионирование (несколько записей с разными version_label)<br>• Флаги: is_current, is_rag_enabled<br>• UI для версий с пометкой текущей<br>• Простой ingestion после загрузки<br>• Базовое извлечение текста (txt/md; для pdf/docx может быть stub)<br>• Разбиение на чанки и сохранение в RagChunk<br>• Возможность переиндексации<br>• Статус индексации в UI (Indexed/Not indexed/Error)<br>• Вкладка "Документы-источники" с фильтрами по типу, статусу, языку<br>• Мини-просмотр для текстовых форматов<br>• Права доступа: Project Owner/Editor загружают, Viewer только просмотр<br>• Мягкое удаление (пометка archived) |
| **Что отсутствует в Prod+** | • Продвинутое версионирование (major/minor, связи "заменяет/заменён")<br>• Статусы документа: draft → in_review → approved_for_RAG → effective → superseded → archived<br>• История изменений статусов<br>• Workflow согласования (настраиваемый список согласующих)<br>• Электронная подпись (e-signature, совместимость с 21 CFR Part 11)<br>• Интеграция с DMS/eTMF (Veeva) — ссылки на внешние документы<br>• Синхронизация метаданных с внешними системами<br>• Расширенный пайплайн извлечения текста (PDF/DOCX через специализированные библиотеки)<br>• Разметка текста на логические разделы<br>• Section-aware RAG<br>• Мультиязычность и много-региональность (метаданные по языку/региону, версии для разных регионов)<br>• Безопасность: классификация по уровню чувствительности, шифрование<br>• Мониторинг и диагностика RAG ingestion<br>• Отчетность и контроль использования документов-источников |

---

## 3. Структура документа и редактор

### 3.1. Общая концепция структуры документа

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Структура документа (Document → Sections)<br>• Модель разделов (CsrSection: id, code, title, order_index)<br>• Дерево разделов в UI<br>• Выбор раздела для редактирования |
| **Что отсутствует в Prod** | • Иерархическая структура (parent_section_id)<br>• Флаги: is_required, is_repeated<br>• Модель Document (id, study_id, type, title, template_code, status, current_version_label, created_by, created_at, updated_at) |
| **Что отсутствует в Prod+** | • Кастомные структуры документа<br>• Управление несколькими вариантами структуры под разные регуляторы |

### 3.2. PROD — базовый уровень

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Редактор текста разделов (TextField)<br>• Сохранение версий разделов (saveSectionVersion)<br>• Получение последней версии (getLatestSectionVersion)<br>• Базовое отображение структуры в дереве |
| **Что отсутствует в Prod** | • Модель SectionVersion (id, section_id, text, created_by, created_at, source, template_id, comment)<br>• Список предыдущих версий<br>• Откат версии<br>• Rich-text редактор (стили, подзаголовки, жирный, курсив, списки, базовые таблицы, ссылки)<br>• Автосохранение черновика<br>• Просмотр plain текста<br>• Навигация по структуре с индикацией статуса раздела<br>• Бэйджи с количеством Issues от QC<br>• Работа с шаблонами разделов (применение шаблона, редактирование после)<br>• Права доступа: Editor/выше редактируют, Viewer только чтение<br>• Soft-lock разделов (предупреждение при редактировании)<br>• Базовый экспорт документа (Word/PDF) |
| **Что отсутствует в Prod+** | • Расширенная модель статусов разделов (draft → in_review → approved → locked)<br>• Hard-lock разделов (один редактор одновременно)<br>• Отображение, кто редактирует<br>• Near-real-time обновление<br>• Тонкое версионирование с метками (v0.1, v0.2, v1.0)<br>• Встроенный diff для двух версий<br>• Change log по разделу/документу<br>• Режим предложений / track changes<br>• Глубокая интеграция с Consistency & Compliance checker<br>• AI-инструменты внутри редактора<br>• Расширенные возможности форматирования<br>• Структурные шаблоны и кастомные структуры<br>• Улучшенный экспорт/импорт (Word с сохранением стилей, ограниченный импорт из Word)<br>• Роли и workflow вокруг разделов (section owner, reviewer, approver) |

---

## 4. AI-ассистент

### 4.1. Общая концепция AI-ассистента

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовый AI-ассистент (AiAssistantPanel)<br>• Генерация текста раздела (generateSectionText API)<br>• Интеграция в редактор (кнопка генерации, режим replace/append) |
| **Что отсутствует в Prod** | • Базовые сценарии: генерация черновика, переформулировка/улучшение текста, локальные подсказки<br>• Минимальный API с валидацией (проверка доступа, ограничения по размерам и частоте)<br>• Интеграция с RAG (подтягивание контекста: протокол, SAP, TLF, прошлый CSR)<br>• Формирование структурированного prompt<br>• UX в редакторе: кнопка "Сгенерировать с помощью AI", индикация загрузки, опция append<br>• Боковая панель AI Assistant с произвольными вопросами<br>• Логирование вызовов AI (study_id, section_id, user_id, prompt, модель, timestamp)<br>• История вызовов AI для раздела<br>• Базовая безопасность: только авторизованные пользователи проекта<br>• Конфигурация модели и API-ключей в защищенном хранилище<br>• Rate limiting<br>• Prompt-шаблоны: не выдумывать данные, обозначать отсутствие данных, избегать маркетинга<br>• Специализированные prompt-шаблоны для ключевых разделов |
| **Что отсутствует в Prod+** | • Расширенная матрица сценариев (суммаризация, объяснение, сравнение версий, перевод RU↔EN)<br>• Глубокая интеграция с шаблонами и правилами<br>• Управление моделями и провайдерами (несколько моделей, выбор по организации/проекту)<br>• Продвинутый контроль качества и feedback loop (интерфейс обратной связи, статистика полезности)<br>• Расширенный аудит и соответствие регуляторным требованиям<br>• Ролевые ограничения и политики использования<br>• Продвинутая работа с контекстом и персонализация (семантический поиск, style guide)<br>• Интеграция в CI/QC-процессы |

---

## 5. RAG

### 5.1. Общая концепция RAG

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовый просмотр RAG-чанков (RagInspectorPanel)<br>• API для получения чанков (getRagChunksForStudy)<br>• Фильтрация по типу источника<br>• Пагинация результатов |
| **Что отсутствует в Prod** | • Модель данных RagChunk (id, study_id, project_id, source_document_id, source_type, order_index, text, created_at, created_by)<br>• Индексы для быстрого поиска<br>• Базовый ingestion-пайплайн (извлечение текста, разбиение на чанки)<br>• Простая стратегия чанкинга (по абзацам, ограничение размера, исключение пустых)<br>• Базовый ретривер (выбор первых N чанков для каждого source_type)<br>• Функция build_rag_context (сборка контекста по типам источников)<br>• Использование RAG в AI-ассистенте (подтягивание чанков, формирование prompt)<br>• Диагностический endpoint и UI панель RAG debug<br>• Безопасность: доступ только через backend-API с проверкой прав |
| **Что отсутствует в Prod+** | • Семантический поиск и эмбеддинги (векторные представления в pgvector/ES)<br>• Продвинутое ранжирование и отбор контекста (BM25 + эмбеддинги, tokens budget)<br>• Section-aware RAG (разметка чанков по структуре документов)<br>• Региональность и языки (мульти-языковые индексы, приоритет чанков на языке документа)<br>• Версионирование RAG-данных и воспроизводимость (привязка к версиям исходных документов, RAG-snapshot для вызова)<br>• Мониторинг и качество RAG (метрики, доля не проиндексированных, время ingestion)<br>• Управляемость и конфигурация RAG (настройки для админа, приоритеты источников, лимиты)<br>• Интеграция с QC и AI-ассистентом<br>• Безопасность и соответствие (классификация RAG-данных, политики retention/удаления) |

---

## 6. Consistency / QC

### 6.1. Общая концепция Consistency / QC

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовый UI для отображения Issues (IssueListPanel)<br>• Mock-данные для демонстрации |
| **Что отсутствует в Prod** | • Объекты: Rule, QCRun, Issue<br>• Базовые классы правил: Numeric consistency (сверка N и %, p-value и CI), Structural consistency (обязательные разделы, ссылки на таблицы), Terminology/style, Regulatory basic<br>• Запуск QC: ручной "Проверить раздел", ручной "Проверить весь документ" (синхронный для разделов, асинхронный для документа)<br>• UI панель QC с фильтрацией по разделам, категориям, серьезности<br>• Счетчик проблем по уровням<br>• Индикация числа Issues в редакторе<br>• Управление Issue: статусы (open → resolved → re-open, wont_fix), права (автор меняет статус), логирование изменений<br>• Интеграция QC с RAG и документами-источниками<br>• Audit trail и отчётность (история QCRun, экспорт списка Issues в Excel/CSV) |
| **Что отсутствует в Prod+** | • Расширенный rule engine и rule packs (конфигурируемые правила, включение/выключение, версионирование правил, базовый пакет ICH E3, региональные пакеты, спонсорские)<br>• Дополнительные классы проверок (расширенные numeric & logical rules, cross-section consistency, регуляторные правила высокого уровня)<br>• Auto-fix и AI-подсказки<br>• Ролевые представления и workflow QC (Medical writer view, Statistician view, RA/QA view, назначение Issues, этапы QC)<br>• Интеграция с CI/CD документа (QC как gate для статуса, привязка QCRun к версиям)<br>• Метрики и дашборды качества<br>• Feedback loop и улучшение правил<br>• Соответствие требованиям инспекций и audit trail |

---

## 7. Экспорт и формат

### 7.1. Общая концепция экспорта и форматов

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | — |
| **Что отсутствует в Prod** | • Базовые форматы экспорта (DOCX, PDF)<br>• Структура и оглавление (разделы как заголовки Heading 1/2/3, порядок по order_index, простое TOC)<br>• Базовые стили и форматирование (заголовки → Word-стили, основной текст Normal, списки и таблицы)<br>• Экспорт таблиц и фигур (базовые Word-таблицы, фигуры как ссылки/подписи)<br>• Экспорт всего документа и отдельных разделов<br>• Локализация по языку (EN/RU, корректная кодировка и шрифты)<br>• Права доступа и аудит при экспорте (логирование: кто, когда, какой документ, формат) |
| **Что отсутствует в Prod+** | • Интеграция с корпоративными Word-шаблонами (DOTX-шаблоны, маппинг стилей, титульная страница, шапки/подвалы, логотипы, настраиваемые профили экспорта)<br>• Расширенное форматирование и нумерация (автоматическая нумерация таблиц/рисунков, перекрёстные ссылки через поля Word)<br>• Продвинутый экспорт PDF (оглавление с гиперссылками, закладки, защита от редактирования, водяные знаки)<br>• Мультирегиональные и multi-output профили (EMA/FDA/EAEU, разные variant документы)<br>• Экспорт структурированных пакетов (eCTD/регуляторные системы, набор файлов с заданными именами)<br>• Round-trip: импорт изменений из Word (сопоставление разделов, обновление текста)<br>• Поддержка track changes и комментариев<br>• Права и контроль версий экспортируемых документов<br>• Отчётность и аудит по экспортам |

---

## 8. Техническая обвязка и "гигиена"

### 8.1. Общая концепция технической "гигиены"

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | • Базовая структура проекта (React + TypeScript + Vite)<br>• ESLint для линтинга<br>• TypeScript с строгим режимом<br>• Базовый HTTP-клиент с обработкой ошибок |
| **Что отсутствует в Prod** | • Конфигурация и окружения (разделение dev/test/prod, переменные окружения, документация)<br>• Логирование (структурированные логи, уровни INFO/ERROR/DEBUG, формат для агрегации, stack trace и correlation id)<br>• Обработка ошибок (централизованный обработчик, различение 4xx/5xx, единый формат, дружелюбные сообщения на фронте)<br>• Миграции БД (Alembic или аналог, все изменения через миграции, история в репозитории)<br>• Тестирование и базовый CI (unit-тесты для бизнес-логики, интеграционные тесты, CI-пайплайн с линтерами, код-стайл)<br>• Безопасность минимум (password hashing, проверка прав на уровне API, HTTPS, защита от OWASP)<br>• Резервное копирование (регулярные бэкапы БД и хранилища, скрипт восстановления, документация RTO/RPO)<br>• Мониторинг базового уровня (health-check endpoint, базовые метрики, простейшие алерты) |
| **Что отсутствует в Prod+** | • Наблюдаемость (централизованное логирование ELK/Loki, дашборды, бизнес-метрики, distributed tracing Jaeger/Tempo)<br>• Полноценный CI/CD-пайплайн (сборка образов Docker, автоматический деплой на dev/test, контролируемый на prod)<br>• Управление секретами (Vault/KMS, ротация ключей, конфигурация per environment/tenant)<br>• Безопасность enterprise-уровня (WAF/Reverse proxy, rate limiting, SSO SAML/OIDC, SCIM)<br>• Масштабируемость и производительность (горизонтальное масштабирование, stateless backend, performance testing, SLA/SLO)<br>• Управление фичами (feature flags, поэтапный rollout)<br>• Управление данными и privacy (retention политики, архивирование, маскирование для non-prod, запрет PHI/PII в dev/test)<br>• Disaster recovery и устойчивость (план восстановления, RPO/RTO, репликация БД, гео-резервирование)<br>• Документация, runbook и операционные процессы |

---

## 9. Дополнительные компоненты

### 9.1. Общая концепция дополнительных компонентов

| Категория | Статус |
|-----------|--------|
| **Что есть в MVP** | — |
| **Что отсутствует в Prod** | • Коллаборация: комментарии к документу/разделу/фрагменту, thread'ы, упоминания пользователей, in-app уведомления, email-уведомления, простая система задач<br>• Поиск и навигация: глобальный поиск по проектам/документам/разделам, full-text по содержимому, глоссарий и справочники<br>• Интеграции: REST/GraphQL API, Webhooks, интеграции с внешними системами (EDC, DMS/eTMF, CTMS)<br>• Админка: администраторская панель (управление организациями/тенантами, пользователями, ролями, настройка шаблонов, QC rule packs), конфигурация фич и лимитов<br>• Лицензирование: модель лицензирования, учёт использования, интеграция с внешним биллингом<br>• Onboarding: встроенный onboarding (guided tour, контекстные подсказки), документация и база знаний, demo/sandbox режим<br>• Право и комплаенс: Data governance и privacy, согласия и политики<br>• Инструменты поддержки: Support view, Feature flags-консоль, инструменты миграции и импорта |
| **Что отсутствует в Prod+** | Все расширенные функции из Prod+ для каждого блока |

---

## Итоговые выводы

### Общая статистика покрытия

1. **Пользователи и проекты**: Базовая аутентификация есть, но отсутствует полная модель пользователей, ролей, членства в проектах
2. **Документы-источники**: Реализована базовая загрузка, отсутствует версионирование и расширенная модель
3. **Структура документа и редактор**: Есть базовый редактор текста, отсутствует rich-text и расширенные возможности
4. **AI-ассистент**: Есть базовая генерация текста, но отсутствует полная интеграция с RAG и расширенные сценарии
5. **RAG**: Есть просмотр чанков, но отсутствует полноценный ingestion и семантический поиск
6. **Consistency / QC**: Только mock-данные, отсутствует реальная реализация правил и проверок
7. **Экспорт и формат**: Полностью отсутствует
8. **Техническая гигиена**: Базовая структура есть, но отсутствуют важные компоненты для продакшена

### Приоритетные области для развития Prod

1. Экспорт документов (Word/PDF) — критично для практического использования
2. Полноценная система QC с реальными правилами
3. Rich-text редактор и версионирование разделов
4. Модель пользователей и ролей с правами доступа
5. Расширенная модель проектов со статусами и жизненным циклом

| **1. Модель пользователей (Prod)** | • Базовый логин (email/username + пароль)<br>• JWT-аутентификация<br>• Хранение токена в localStorage | • Профиль пользователя (имя, фамилия, должность, организация, часовой пояс)<br>• Флаги активен/деактивирован, требуется смена пароля<br>• Минимальные требования к паролю<br>• Пригласительная модель регистрации (админ создает пользователя, отправка письма/ссылки для установки пароля)<br>• Массовая загрузка пользователей (CSV/Excel)<br>• Блокировка/разблокировка без удаления истории<br>• Страница "Мой профиль" с редактированием имени, должности, контактов, сменой пароля<br>• Отображение роли/ролей и списка проектов с доступом | • Организации/тенанты (multi-tenant архитектура)<br>• Связь пользователей и проектов с организацией<br>• Изоляция данных между организациями<br>• Сущность "Спонсор" как справочник<br>• Расширенный RBAC (Org Admin, Sponsor Admin, Portfolio Manager)<br>• Проектные роли с детальными правами<br>• Настройка ролей в админке с матрицей прав<br>• SSO (SAML/OAuth2/OIDC)<br>• SCIM для синхронизации с IdP<br>• Маппинг групп/атрибутов IdP на роли |
| **2. Модель проектов / исследований (Prod)** | • Базовые поля проекта (id, code, title, phase)<br>• Список исследований в боковой панели<br>• Выбор активного исследования<br>• API для получения списка и создания | • Уникальный project_id/study_id<br>• Расширенные поля: спонсор, показание, тип исследования<br>• Статус проекта (draft/active/in_QC/submitted/archived)<br>• Владелец проекта (ответственный пользователь)<br>• Создание проекта с правом "create_project"<br>• Перевод по статусам с контролем прав<br>• Логирование изменений статуса<br>• Архивный статус с read-only доступом<br>• Структура внутри проекта (список документов/артефактов)<br>• Привязка источников RAG к проекту<br>• Ключевые даты (начало/окончание набора, ЛПД, целевая дата подачи) | • Иерархия проектов и портфели<br>• Сущность "Портфель"/"Программа" (группировка по препарату, показанию, региону)<br>• Права на уровень портфеля<br>• Иерархия: Портфель → Проект → Документы<br>• Разделение PROD/UAT/DEV окружений<br>• Миграция проектов/шаблонов из UAT в PROD<br>• Настройки квот (лимиты на проекты, пользователей, хранилище на организацию) |
| **3. Связь "пользователи ↔ проекты" (Prod)** | • Пользователь видит список исследований<br>• Базовое ограничение доступа через API | • Явная модель membership (project_member таблица: user_id + project_id + роль)<br>• Роли внутри проекта (Project Owner, Editor, Viewer)<br>• Project Owner может добавлять/удалять участников, менять роли, назначать владельца<br>• Проверки: нельзя удалить последнего владельца<br>• Страница "Мои проекты" с фильтрацией по статусу<br>• Быстрый поиск по коду/названию<br>• Отображение роли пользователя в каждом проекте<br>• Сортировки (по дате обновления, статусу, спонсору) | • Удаление участника с проверкой незавершенных задач<br>• Portfolio Manager видит все исследования по молекуле<br>• Расширенные права на уровне портфеля |
| **4. Роли и права доступа (Prod)** | • Базовая проверка аутентификации<br>• JWT-токены для доступа к API | • Глобальные роли системы (Admin, User)<br>• Admin: управление пользователями, просмотр всех проектов, настройка конфигураций<br>• User: доступ только к проектам-участникам<br>• Централизованная проверка прав на уровне API<br>• Проверка membership и роли при действиях с проектом/документом<br>• Доступ к RAG-данным строго в рамках проектов пользователя<br>• Логирование отказов в доступе | • Расширенные роли (Org Admin, Sponsor Admin, Portfolio Manager)<br>• Проектные роли с детальными правами (редактирование только efficacy, но не safety)<br>• Настройка ролей в административном интерфейсе<br>• Матрица прав для ролей |
| **5. Аудит и история действий (Prod)** | • Базовая структура для работы с документами | • Логирование ключевых событий: создание/изменение/архивация проекта, добавление/удаление участника, изменение ролей, изменение статуса<br>• Хранение: кто, когда, что изменил<br>• Привязка к версиям документов (кто создал/обновил версию)<br>• Связка версий с пользователями и статусами проекта | • Тонкий аудит: входы/выходы, попытки доступа без прав, массовые изменения прав<br>• Политики безопасности (требования к паролю, срок жизни, автоматическая блокировка)<br>• Отчеты для QA/RA с возможностью выгрузить список всех мест использования AI |
| **6. PROD+ — расширенная модель пользователей и проектов** | — | — | • Организации, тенанты и спонсоры (multi-tenant)<br>• Расширенный RBAC<br>• SSO и управление идентичностью<br>• Иерархия проектов и портфели<br>• Дополнительный аудит и политики<br>• SLA и разграничение окружений<br>• Отчетность и аналитика по пользователям и проектам (дашборды, активность, загрузка команд, экспорт отчетов) |
| **1. Общая концепция документов-источников** | • Базовые типы документов (protocol, sap, tlf, csr_prev)<br>• Загрузка файлов через UI<br>• Список загруженных документов<br>• API для загрузки и получения списка | • Модель данных SourceDocument с расширенными полями (version_label, language, region, status, source_system, storage_path, file_name, mime_type, size_bytes)<br>• Типы документов: ib, smpc, other<br>• Возможность отметить "ключевые" документы для RAG/QC<br>• Проверка расширения и валидности при загрузке<br>• Безопасное хранение (S3-совместимое хранилище)<br>• Скачивание файлов пользователями с правами | • Расширенные типы и подтипы (Protocol original/amendment, SAP original/update, CSR draft/final/addendum, Regulatory correspondence)<br>• Маппинг типов на регуляторные артефакты (CTD-модуль, раздел ICH E3) |
| **2. PROD — базовый уровень для документов-источников** | • Загрузка документов-источников<br>• Базовый список документов с типом и датой загрузки<br>• Ручная индексация для RAG (indexSourceDocument API) | • Базовое версионирование (несколько записей с разными version_label)<br>• Флаги: is_current, is_rag_enabled<br>• UI для версий с пометкой текущей<br>• Простой ingestion после загрузки<br>• Базовое извлечение текста (txt/md; для pdf/docx может быть stub)<br>• Разбиение на чанки и сохранение в RagChunk<br>• Возможность переиндексации<br>• Статус индексации в UI (Indexed/Not indexed/Error)<br>• Вкладка "Документы-источники" с фильтрами по типу, статусу, языку<br>• Мини-просмотр для текстовых форматов<br>• Права доступа: Project Owner/Editor загружают, Viewer только просмотр<br>• Мягкое удаление (пометка archived) | • Продвинутое версионирование (major/minor, связи "заменяет/заменён")<br>• Статусы документа: draft → in_review → approved_for_RAG → effective → superseded → archived<br>• История изменений статусов<br>• Workflow согласования (настраиваемый список согласующих)<br>• Электронная подпись (e-signature, совместимость с 21 CFR Part 11)<br>• Интеграция с DMS/eTMF (Veeva) — ссылки на внешние документы<br>• Синхронизация метаданных с внешними системами<br>• Расширенный пайплайн извлечения текста (PDF/DOCX через специализированные библиотеки)<br>• Разметка текста на логические разделы<br>• Section-aware RAG<br>• Мультиязычность и много-региональность (метаданные по языку/региону, версии для разных регионов)<br>• Безопасность: классификация по уровню чувствительности, шифрование<br>• Мониторинг и диагностика RAG ingestion<br>• Отчетность и контроль использования документов-источников |
| **1. Общая концепция структуры документа** | • Структура документа (Document → Sections)<br>• Модель разделов (CsrSection: id, code, title, order_index)<br>• Дерево разделов в UI<br>• Выбор раздела для редактирования | • Иерархическая структура (parent_section_id)<br>• Флаги: is_required, is_repeated<br>• Модель Document (id, study_id, type, title, template_code, status, current_version_label, created_by, created_at, updated_at) | • Кастомные структуры документа<br>• Управление несколькими вариантами структуры под разные регуляторы |
| **2. PROD — базовый уровень** | • Редактор текста разделов (TextField)<br>• Сохранение версий разделов (saveSectionVersion)<br>• Получение последней версии (getLatestSectionVersion)<br>• Базовое отображение структуры в дереве | • Модель SectionVersion (id, section_id, text, created_by, created_at, source, template_id, comment)<br>• Список предыдущих версий<br>• Откат версии<br>• Rich-text редактор (стили, подзаголовки, жирный, курсив, списки, базовые таблицы, ссылки)<br>• Автосохранение черновика<br>• Просмотр plain текста<br>• Навигация по структуре с индикацией статуса раздела<br>• Бэйджи с количеством Issues от QC<br>• Работа с шаблонами разделов (применение шаблона, редактирование после)<br>• Права доступа: Editor/выше редактируют, Viewer только чтение<br>• Soft-lock разделов (предупреждение при редактировании)<br>• Базовый экспорт документа (Word/PDF) | • Расширенная модель статусов разделов (draft → in_review → approved → locked)<br>• Hard-lock разделов (один редактор одновременно)<br>• Отображение, кто редактирует<br>• Near-real-time обновление<br>• Тонкое версионирование с метками (v0.1, v0.2, v1.0)<br>• Встроенный diff для двух версий<br>• Change log по разделу/документу<br>• Режим предложений / track changes<br>• Глубокая интеграция с Consistency & Compliance checker<br>• AI-инструменты внутри редактора<br>• Расширенные возможности форматирования<br>• Структурные шаблоны и кастомные структуры<br>• Улучшенный экспорт/импорт (Word с сохранением стилей, ограниченный импорт из Word)<br>• Роли и workflow вокруг разделов (section owner, reviewer, approver) |
| **1. Общая концепция AI-ассистента** | • Базовый AI-ассистент (AiAssistantPanel)<br>• Генерация текста раздела (generateSectionText API)<br>• Интеграция в редактор (кнопка генерации, режим replace/append) | • Базовые сценарии: генерация черновика, переформулировка/улучшение текста, локальные подсказки<br>• Минимальный API с валидацией (проверка доступа, ограничения по размерам и частоте)<br>• Интеграция с RAG (подтягивание контекста: протокол, SAP, TLF, прошлый CSR)<br>• Формирование структурированного prompt<br>• UX в редакторе: кнопка "Сгенерировать с помощью AI", индикация загрузки, опция append<br>• Боковая панель AI Assistant с произвольными вопросами<br>• Логирование вызовов AI (study_id, section_id, user_id, prompt, модель, timestamp)<br>• История вызовов AI для раздела<br>• Базовая безопасность: только авторизованные пользователи проекта<br>• Конфигурация модели и API-ключей в защищенном хранилище<br>• Rate limiting<br>• Prompt-шаблоны: не выдумывать данные, обозначать отсутствие данных, избегать маркетинга<br>• Специализированные prompt-шаблоны для ключевых разделов | • Расширенная матрица сценариев (суммаризация, объяснение, сравнение версий, перевод RU↔EN)<br>• Глубокая интеграция с шаблонами и правилами<br>• Управление моделями и провайдерами (несколько моделей, выбор по организации/проекту)<br>• Продвинутый контроль качества и feedback loop (интерфейс обратной связи, статистика полезности)<br>• Расширенный аудит и соответствие регуляторным требованиям<br>• Ролевые ограничения и политики использования<br>• Продвинутая работа с контекстом и персонализация (семантический поиск, style guide)<br>• Интеграция в CI/QC-процессы |
| **1. Общая концепция RAG** | • Базовый просмотр RAG-чанков (RagInspectorPanel)<br>• API для получения чанков (getRagChunksForStudy)<br>• Фильтрация по типу источника<br>• Пагинация результатов | • Модель данных RagChunk (id, study_id, project_id, source_document_id, source_type, order_index, text, created_at, created_by)<br>• Индексы для быстрого поиска<br>• Базовый ingestion-пайплайн (извлечение текста, разбиение на чанки)<br>• Простая стратегия чанкинга (по абзацам, ограничение размера, исключение пустых)<br>• Базовый ретривер (выбор первых N чанков для каждого source_type)<br>• Функция build_rag_context (сборка контекста по типам источников)<br>• Использование RAG в AI-ассистенте (подтягивание чанков, формирование prompt)<br>• Диагностический endpoint и UI панель RAG debug<br>• Безопасность: доступ только через backend-API с проверкой прав | • Семантический поиск и эмбеддинги (векторные представления в pgvector/ES)<br>• Продвинутое ранжирование и отбор контекста (BM25 + эмбеддинги, tokens budget)<br>• Section-aware RAG (разметка чанков по структуре документов)<br>• Региональность и языки (мульти-языковые индексы, приоритет чанков на языке документа)<br>• Версионирование RAG-данных и воспроизводимость (привязка к версиям исходных документов, RAG-snapshot для вызова)<br>• Мониторинг и качество RAG (метрики, доля не проиндексированных, время ingestion)<br>• Управляемость и конфигурация RAG (настройки для админа, приоритеты источников, лимиты)<br>• Интеграция с QC и AI-ассистентом<br>• Безопасность и соответствие (классификация RAG-данных, политики retention/удаления) |
| **1. Общая концепция Consistency / QC** | • Базовый UI для отображения Issues (IssueListPanel)<br>• Mock-данные для демонстрации | • Объекты: Rule, QCRun, Issue<br>• Базовые классы правил: Numeric consistency (сверка N и %, p-value и CI), Structural consistency (обязательные разделы, ссылки на таблицы), Terminology/style, Regulatory basic<br>• Запуск QC: ручной "Проверить раздел", ручной "Проверить весь документ" (синхронный для разделов, асинхронный для документа)<br>• UI панель QC с фильтрацией по разделам, категориям, серьезности<br>• Счетчик проблем по уровням<br>• Индикация числа Issues в редакторе<br>• Управление Issue: статусы (open → resolved → re-open, wont_fix), права (автор меняет статус), логирование изменений<br>• Интеграция QC с RAG и документами-источниками<br>• Audit trail и отчётность (история QCRun, экспорт списка Issues в Excel/CSV) | • Расширенный rule engine и rule packs (конфигурируемые правила, включение/выключение, версионирование правил, базовый пакет ICH E3, региональные пакеты, спонсорские)<br>• Дополнительные классы проверок (расширенные numeric & logical rules, cross-section consistency, регуляторные правила высокого уровня)<br>• Auto-fix и AI-подсказки<br>• Ролевые представления и workflow QC (Medical writer view, Statistician view, RA/QA view, назначение Issues, этапы QC)<br>• Интеграция с CI/CD документа (QC как gate для статуса, привязка QCRun к версиям)<br>• Метрики и дашборды качества<br>• Feedback loop и улучшение правил<br>• Соответствие требованиям инспекций и audit trail |
| **1. Общая концепция экспорта и форматов** | — | • Базовые форматы экспорта (DOCX, PDF)<br>• Структура и оглавление (разделы как заголовки Heading 1/2/3, порядок по order_index, простое TOC)<br>• Базовые стили и форматирование (заголовки → Word-стили, основной текст Normal, списки и таблицы)<br>• Экспорт таблиц и фигур (базовые Word-таблицы, фигуры как ссылки/подписи)<br>• Экспорт всего документа и отдельных разделов<br>• Локализация по языку (EN/RU, корректная кодировка и шрифты)<br>• Права доступа и аудит при экспорте (логирование: кто, когда, какой документ, формат) | • Интеграция с корпоративными Word-шаблонами (DOTX-шаблоны, маппинг стилей, титульная страница, шапки/подвалы, логотипы, настраиваемые профили экспорта)<br>• Расширенное форматирование и нумерация (автоматическая нумерация таблиц/рисунков, перекрёстные ссылки через поля Word)<br>• Продвинутый экспорт PDF (оглавление с гиперссылками, закладки, защита от редактирования, водяные знаки)<br>• Мультирегиональные и multi-output профили (EMA/FDA/EAEU, разные variant документы)<br>• Экспорт структурированных пакетов (eCTD/регуляторные системы, набор файлов с заданными именами)<br>• Round-trip: импорт изменений из Word (сопоставление разделов, обновление текста)<br>• Поддержка track changes и комментариев<br>• Права и контроль версий экспортируемых документов<br>• Отчётность и аудит по экспортам |
| **1. Общая концепция технической "гигиены"** | • Базовая структура проекта (React + TypeScript + Vite)<br>• ESLint для линтинга<br>• TypeScript с строгим режимом<br>• Базовый HTTP-клиент с обработкой ошибок | • Конфигурация и окружения (разделение dev/test/prod, переменные окружения, документация)<br>• Логирование (структурированные логи, уровни INFO/ERROR/DEBUG, формат для агрегации, stack trace и correlation id)<br>• Обработка ошибок (централизованный обработчик, различение 4xx/5xx, единый формат, дружелюбные сообщения на фронте)<br>• Миграции БД (Alembic или аналог, все изменения через миграции, история в репозитории)<br>• Тестирование и базовый CI (unit-тесты для бизнес-логики, интеграционные тесты, CI-пайплайн с линтерами, код-стайл)<br>• Безопасность минимум (password hashing, проверка прав на уровне API, HTTPS, защита от OWASP)<br>• Резервное копирование (регулярные бэкапы БД и хранилища, скрипт восстановления, документация RTO/RPO)<br>• Мониторинг базового уровня (health-check endpoint, базовые метрики, простейшие алерты) | • Наблюдаемость (централизованное логирование ELK/Loki, дашборды, бизнес-метрики, distributed tracing Jaeger/Tempo)<br>• Полноценный CI/CD-пайплайн (сборка образов Docker, автоматический деплой на dev/test, контролируемый на prod)<br>• Управление секретами (Vault/KMS, ротация ключей, конфигурация per environment/tenant)<br>• Безопасность enterprise-уровня (WAF/Reverse proxy, rate limiting, SSO SAML/OIDC, SCIM)<br>• Масштабируемость и производительность (горизонтальное масштабирование, stateless backend, performance testing, SLA/SLO)<br>• Управление фичами (feature flags, поэтапный rollout)<br>• Управление данными и privacy (retention политики, архивирование, маскирование для non-prod, запрет PHI/PII в dev/test)<br>• Disaster recovery и устойчивость (план восстановления, RPO/RTO, репликация БД, гео-резервирование)<br>• Документация, runbook и операционные процессы |
| **Дополнительные компоненты** | — | • Коллаборация: комментарии к документу/разделу/фрагменту, thread'ы, упоминания пользователей, in-app уведомления, email-уведомления, простая система задач<br>• Поиск и навигация: глобальный поиск по проектам/документам/разделам, full-text по содержимому, глоссарий и справочники<br>• Интеграции: REST/GraphQL API, Webhooks, интеграции с внешними системами (EDC, DMS/eTMF, CTMS)<br>• Админка: администраторская панель (управление организациями/тенантами, пользователями, ролями, настройка шаблонов, QC rule packs), конфигурация фич и лимитов<br>• Лицензирование: модель лицензирования, учёт использования, интеграция с внешним биллингом<br>• Onboarding: встроенный onboarding (guided tour, контекстные подсказки), документация и база знаний, demo/sandbox режим<br>• Право и комплаенс: Data governance и privacy, согласия и политики<br>• Инструменты поддержки: Support view, Feature flags-консоль, инструменты миграции и импорта | Все расширенные функции из Prod+ для каждого блока |

